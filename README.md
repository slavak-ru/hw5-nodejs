# Большая домашняя работа курса по Node.js - Корпоративная система "UndefnedSystem".
## Задача - реализовать backend часть.
## <b>Frontend (vue.js) не мой</b>. Получил as-is. По этой причине клиент не работает в IE11, так как клиентский скрипт использует fetch без полифилла, есть клиентские проблемы с роутингом, верстка не адаптивная (не адаптирована для моб.устройств).
## <b>Деплой осуществлен на Heroku через Travis. [Демо](https://hw5-nodejs.herokuapp.com)</b>

<b>Использованный фреймворк</b> - Express.js.
Настройки сервера хрантся в config/config-dev.json для development-mode, config/config-prod.json для production-mode

### База данных</b>  
MongoDB (используется ORM - Mongoose).  
Локальная база - ubdefinedSystem.  
В продакшене используется mLab.  
Коллекции: user, permission, news, sessions.  


### Реализована серверная логика обработки 12 различных запросов:
> Http-сервер на любой get-запрос возвращает index.html (маршрутизация выполняется на frontend'e средствами бибилиотеки vue-router).  

> POST-запрос на /api/saveNewUser - создание нового пользователя (регистрация). Возвращает объект созданного пользователя.

> POST-запрос на /api/login - авторизация после пользователького ввода. Возвращает объект авторизовавшегося пользователя.

> Автоматический POST-запрос на /api/authFromToken - авторизация при наличии токена. Возвращает объект авторизовавшегося пользователя.

> PUT-запрос на /api/updateUser/:id - обновление информации о пользователе. Возвращает объект  обновленного пользователя.

> DELETE-запрос на /api/deleteUser/:id - удаление пользователя. Возвращает всех пользователей. Если в настройках сервера deleteUserNews имеет значение true - из базы удаляются все новости созданные этим пользователем Если false то новости созданныепользователем не удаляются, но указывается , что "Пользователь удален".

> POST-запрос на /api/saveUserImage/:id - сохранение изображения пользователя. Возвращает объект обновленного пользователя со свойством path, которое хранит путь до сохраненного изображения. На сервере изображение обрезается до квадратных пропорций и сжимается посредвом jimp.

> Автоматический GET-запрос на /api/getNews - получение списка новостей. Возвращает список всех новостей из базы данных.

> POST-запрос на /api/newNews - создание новой новости. Возвращает обновленный список всех новостей из базы данных.

> PUT-запрос на /api/updateNews/:id - обновление существующей новости. Возвращает обновленный список всех новостей из базы данных.

> DELETE-запрос на /api/deleteNews/:id - удаление существующей новости. Возвращает обновленный список всех новостей из базы данных.

> Автоматический GET-запрос на /api/getUsers - получение списка пользователей. Возвращает список всех пользоватлей из базы данных.

> PUT-запрос на /api/updateUserPermission/:id - обновление существующей записи о разрешениях конкретного пользователя.

### Чат (/chat)
Реализована логика взаимодействия frontend и backend частей между собой с помощью socket. Необходимо для реализации чата. Хеш-объект, в который запишисываютс все активные подключения в формате:
{ #id: {
  username: #username,
  id: #id
  },
  ...
}

#### Ваше socket-подключение обрабатывает следующие события:

> connection, инициируется при подключении пользователя. Создается объект пользователя в котором сохраняется id сокета и имя пользователя, как свойства; обновить общий объект, отправить его только что подключившемуся пользователю (с помощью события all users) и разослать всем подключенным сокетам объект нового пользователя (с помощью события new user).

> chat message, инициируется при отправке одним из пользователей сообщения другому. Передается пользователю-получателю в параметрах текст сообщения и id отправителя с помощью события chat message.

> disconnect, инициируется при отключении пользователя. Передается всем подключенным пользователям id отключившегося пользователя (с помощью события delete user), и удаляется пользователя из объекта всех подключенных пользователей.

Подготовьте окружение и запустите проект на выбранном вами хостинге (например, heroku).


### Дополнительное задание 2: 
обеспечьте возможность работы приложения в 2 режимах - development и producton. В development режиме приложение должно быть подключено к локальной базе данных, в то время как в producton режиме - к удаленной, которая и будет использоваться при работе на хостинге.